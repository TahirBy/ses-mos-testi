<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kör Test (Blind MOS) - Konuşma Kalitesi</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bg-color: #f4f6f7;
        }
        body { font-family: 'Segoe UI', 'Roboto', sans-serif; background-color: var(--bg-color); color: #333; max-width: 800px; margin: 0 auto; padding: 40px 20px; }
        
        h1 { text-align: center; color: var(--primary-color); margin-bottom: 5px; }
        .subtitle { text-align: center; color: #7f8c8d; margin-bottom: 40px; font-size: 0.9em; }

        .info-box { background: #fff; padding: 20px; border-radius: 8px; border-left: 5px solid var(--accent-color); margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }

        /* Skala Tablosu */
        .scale-guide { display: flex; justify-content: space-between; background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 30px; text-align: center; font-size: 0.85em; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .scale-item strong { display: block; font-size: 1.4em; color: var(--accent-color); }

        /* Kart Tasarımı */
        .sample-card { background: #fff; padding: 30px; margin-bottom: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center; transition: transform 0.2s; }
        .sample-card:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }

        .sample-index { font-weight: bold; color: #95a5a6; text-transform: uppercase; font-size: 0.8em; letter-spacing: 1px; margin-bottom: 10px; display: block; }

        audio { width: 100%; max-width: 500px; margin: 20px 0; height: 40px; }

        /* Puanlama */
        .rating-options { display: flex; justify-content: center; gap: 15px; margin-top: 15px; flex-wrap: wrap; }
        .rating-label { cursor: pointer; display: flex; flex-direction: column; align-items: center; width: 60px; padding: 10px; border-radius: 8px; transition: background 0.2s; border: 1px solid transparent; }
        .rating-label:hover { background: #eeffff; border-color: #b2ebf2; }
        .rating-val { font-size: 1.2em; font-weight: bold; color: var(--primary-color); margin-bottom: 5px; }
        .rating-text { font-size: 0.75em; color: #666; }
        input[type="radio"] { transform: scale(1.3); margin-top: 5px; cursor: pointer; }

        /* Form Elemanları */
        .user-info { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        input[type="text"], select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        
        button#submit-btn { width: 100%; padding: 15px; background: var(--accent-color); color: white; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; font-weight: bold; transition: background 0.3s; }
        button#submit-btn:hover { background: #2980b9; }
        button:disabled { background: #bdc3c7; cursor: not-allowed; }
    </style>
</head>
<body>

    <h1>Ses Kalitesi Değerlendirmesi</h1>
    <p class="subtitle">Blind Single Stimulus Test (ACR)</p>

    <div class="info-box">
        <h3>ℹ️ Bilgilendirme</h3>
        <p>Aşağıda karışık sırayla sunulan ses kayıtlarını dinleyiniz. Her bir kaydın <strong>Doğallığını</strong> ve <strong>Netliğini</strong> 1 (Çok Kötü) ile 5 (Mükemmel) arasında puanlayınız. Kayıtların hangisinin orijinal hangisinin model çıktısı olduğu belirtilmemiştir.</p>
    </div>

    <div class="scale-guide">
        <div class="scale-item"><strong>1</strong>Çok Kötü</div>
        <div class="scale-item"><strong>2</strong>Kötü</div>
        <div class="scale-item"><strong>3</strong>Orta</div>
        <div class="scale-item"><strong>4</strong>İyi</div>
        <div class="scale-item"><strong>5</strong>Mükemmel</div>
    </div>

    <form id="mos-form">
        <div class="user-info">
            <label><strong>Rumuzunuz (İsteğe Bağlı):</strong></label>
            <input type="text" name="Katilimci_Ismi" placeholder="Örn: Kullanici1">
            
            <label style="display:block; margin-top:15px;"><strong>Kulaklık Tipi:</strong></label>
            <select name="Donanim">
                <option value="Kulaklik_Kablolu">Kablolu Kulaklık</option>
                <option value="Kulaklik_BT">Bluetooth Kulaklık</option>
                <option value="Hoparlor">Hoparlör</option>
            </select>
        </div>

        <div id="audio-container"></div>

        <button type="submit" id="submit-btn">Testi Tamamla</button>
    </form>

    <script>
        const scriptURL = 'BURAYA_GOOGLE_SCRIPT_URL_GELECEK'; // Kendi URL'nizi buraya yapıştırın

        // 1. ADIM: SES HAVUZU
        // Buraya hem referansları hem modelleri ayrı ayrı ekliyoruz.
        // "id" kısmı Excel'e yazılacak başlık olacak (unique olmalı).
        const rawAudioList = [
            // Örnek 1
            { id: "s1_ref", url: "audio/sample1_ref.wav" },
            { id: "s1_model", url: "audio/sample1_model.wav" },
            
            // Örnek 2
            { id: "s2_ref", url: "audio/sample2_ref.wav" },
            { id: "s2_model", url: "audio/sample2_model.wav" },

            // Örnek 3
            { id: "s3_ref", url: "audio/sample3_ref.wav" },
            { id: "s3_model", url: "audio/sample3_model.wav" },

            // Örnek 4
            { id: "s4_ref", url: "audio/sample4_ref.wav" },
            { id: "s4_model", url: "audio/sample4_model.wav" }
        ];

        // 2. ADIM: KARIŞTIRMA FONKSİYONU (Fisher-Yates Shuffle)
        // Bu fonksiyon listeyi rastgele karıştırır.
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Listeyi karıştır
        const shuffledList = shuffleArray([...rawAudioList]);

        // 3. ADIM: ARAYÜZ OLUŞTURMA
        const container = document.getElementById('audio-container');

        shuffledList.forEach((item, index) => {
            const html = `
            <div class="sample-card">
                <span class="sample-index">Kayıt #${index + 1}</span>
                
                <audio controls controlsList="nodownload" src="${item.url}" preload="none"></audio>
                
                <div class="rating-options">
                    ${[1, 2, 3, 4, 5].map(val => `
                        <label class="rating-label">
                            <span class="rating-val">${val}</span>
                            <input type="radio" name="${item.id}" value="${val}" required>
                            <span class="rating-text">
                                ${val===1?'Çok Kötü': val===2?'Kötü': val===3?'Orta': val===4?'İyi':'Mükemmel'}
                            </span>
                        </label>
                    `).join('')}
                </div>
            </div>`;
            container.innerHTML += html;
        });

        // 4. ADIM: GÖNDERME İŞLEMİ (Değişmedi)
        const form = document.getElementById('mos-form');
        const submitBtn = document.getElementById('submit-btn');

        form.addEventListener('submit', e => {
            e.preventDefault();
            submitBtn.disabled = true;
            submitBtn.innerHTML = "Kaydediliyor...";
            
            const formData = new FormData(form);
            fetch(scriptURL, { method: 'POST', body: formData})
                .then(response => {
                    alert("Teşekkürler! Test başarıyla gönderildi.");
                    submitBtn.innerHTML = "Gönderildi ✅";
                })
                .catch(error => {
                    alert("Hata oluştu!");
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = "Tekrar Dene";
                });
        });
    </script>

</body>
</html>
