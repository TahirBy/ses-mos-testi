<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech Compression Quality Test (MOS)</title>
    <style>
        :root { 
            --primary-color: #2c3e50; 
            --accent-color: #3498db; 
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #c0392b;
            --bg-color: #f0f2f5; 
            --card-bg: #ffffff;
        }

        body { 
            font-family: 'Segoe UI', 'Roboto', Helvetica, Arial, sans-serif; 
            background-color: var(--bg-color); 
            color: #333; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 60px 20px 40px 20px; 
            line-height: 1.6; 
        }

        /* --- PROGRESS BAR --- */
        .progress-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 8px; background-color: #ddd; z-index: 1000;
        }
        .progress-bar {
            height: 100%; background-color: var(--success-color); width: 0%; transition: width 0.3s ease;
        }
        .progress-text {
            position: fixed; top: 10px; right: 20px; background: rgba(0,0,0,0.7); color: white; 
            padding: 5px 10px; border-radius: 15px; font-size: 0.8em; z-index: 1001;
        }

        /* Tipografi */
        h1 { text-align: center; color: var(--primary-color); margin-bottom: 5px; }
        .subtitle { text-align: center; color: #7f8c8d; margin-bottom: 30px; font-weight: 500; }
        
        .en-sub {
            display: block; font-size: 0.85em; font-style: italic; color: #7f8c8d; font-weight: normal; margin-top: 3px;
        }
        .subtitle .en-sub { font-size: 0.9em; }

        /* Bilgi KutularÄ± */
        .info-box { 
            background: var(--card-bg); padding: 25px; border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 25px; 
            border-left: 5px solid var(--accent-color); 
        }
        /* GÃœNCELLEME: Metinleri iki yana yasla */
        .info-box p { 
            margin-bottom: 15px; 
            text-align: justify; 
        }
        .info-box ul { padding-left: 20px; }
        /* GÃœNCELLEME: Liste maddelerini iki yana yasla */
        .info-box li { 
            margin-bottom: 8px; 
            text-align: justify; 
        }

        /* Kalibrasyon Kutusu */
        .calibration-box {
            background: #fff3cd; 
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        /* GÃœNCELLEME: Kalibrasyon metnini iki yana yasla */
        .calibration-box p {
            text-align: justify;
        }

        /* --- DETAYLI PUANLAMA TABLOSU --- */
        .rating-guide-table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            font-size: 0.95em;
        }
        .rating-guide-table th {
            background: var(--primary-color);
            color: #fff;
            padding: 12px;
            text-align: left;
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        .rating-guide-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
            text-align: left; /* Tablo iÃ§eriÄŸi solda kalsÄ±n, daha okunaklÄ± olur */
        }
        .rating-guide-table tr:last-child td { border-bottom: none; }
        
        .score-badge {
            display: inline-block; width: 32px; height: 32px; line-height: 32px;
            text-align: center; border-radius: 50%; color: white; font-weight: bold; font-size: 1.1em;
        }
        .score-5 { background-color: #27ae60; }
        .score-4 { background-color: #88cd38; }
        .score-3 { background-color: #f39c12; }
        .score-2 { background-color: #e67e22; }
        .score-1 { background-color: #c0392b; }

        /* Ses KartlarÄ± */
        .sample-card { 
            background: var(--card-bg); padding: 25px; margin-bottom: 25px; border-radius: 12px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.06); transition: all 0.3s ease; border: 1px solid transparent;
        }
        .sample-card:hover { transform: translateY(-2px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .sample-header { 
            display: flex; justify-content: space-between; align-items: center; 
            border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px; 
        }
        .sample-title { font-weight: bold; font-size: 1.1em; color: #444; }

        audio { width: 100%; margin-bottom: 20px; outline: none; height: 40px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group label { font-weight: bold; display: block; margin-bottom: 8px; color: #2c3e50; }
        input[type="text"], select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }

        /* Rating UI */
        .rating-container { 
            background: #fafafa; padding: 15px; border-radius: 10px; text-align: center; 
            border: 1px solid #eee; transition: all 0.3s;
        }
        .rating-container.locked {
            opacity: 0.5; pointer-events: none; background: #f0f0f0;
        }
        .rating-container.locked::after {
            content: "ğŸ”’ LÃ¼tfen Ã¶nce sesi dinleyiniz / Please listen first";
            display: block; font-size: 0.8em; color: var(--danger-color); margin-top: 10px; font-weight: bold;
        }
        .rating-group { display: flex; justify-content: space-between; gap: 5px; flex-wrap: wrap; }
        .rating-label { 
            cursor: pointer; flex: 1; display: flex; flex-direction: column; align-items: center; 
            padding: 10px 5px; border-radius: 8px; transition: background 0.2s; min-width: 60px;
        }
        .rating-label:hover { background-color: #e8f4fd; }
        .rating-label input { margin-bottom: 8px; transform: scale(1.4); accent-color: var(--accent-color); cursor: pointer; }
        .rating-val { font-weight: bold; font-size: 1.1em; color: var(--primary-color); }
        .rating-desc { font-size: 0.75em; color: #666; line-height: 1.2; margin-top: 4px; }

        button#submit-btn { 
            width: 100%; padding: 18px; background-color: var(--accent-color); color: white; border: none; 
            border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: all 0.3s; margin-top: 30px; 
        }
        button#submit-btn:hover { background-color: #2980b9; transform: translateY(-2px); }
        button:disabled { background-color: #95a5a6; cursor: not-allowed; transform: none; }

        .loading { text-align: center; color: #7f8c8d; font-style: italic; padding: 40px; }
        .footer { text-align: center; font-size: 0.85em; color: #aaa; margin-top: 50px; border-top: 1px solid #eee; padding-top: 20px; }

        @media (max-width: 600px) {
            .form-row { grid-template-columns: 1fr; }
            .rating-guide-table th, .rating-guide-table td { padding: 10px 5px; font-size: 0.85em; }
        }
    </style>
</head>
<body>

    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="progress-text" id="progressText">0%</div>

    <h1>KonuÅŸma SÄ±kÄ±ÅŸtÄ±rma Kalite Testi<span class="en-sub">(Speech Compression Quality Test)</span></h1>
    <p class="subtitle">Subjektif DeÄŸerlendirme (MOS Testi) <span class="en-sub">(Subjective Evaluation - MOS Test)</span></p>

    <div class="info-box">
        <h3>ğŸ“„ Ã‡alÄ±ÅŸmanÄ±n AmacÄ± <span class="en-sub">(Aim of the Study)</span></h3>
        <p>
            Bu Ã§alÄ±ÅŸma, geliÅŸtirilen Ã¶zgÃ¼n bir konuÅŸma sÄ±kÄ±ÅŸtÄ±rma yÃ¶nteminin algÄ±sal baÅŸarÄ±sÄ±nÄ± belirlemek amacÄ±yla gerÃ§ekleÅŸtirilmektedir. Sizlerden beklenen, sunulan ses Ã¶rneklerini dikkatlice dinleyerek, duyduÄŸunuz sesin kalitesini belirtilen kriterlere gÃ¶re puanlamanÄ±zdÄ±r.
            <span class="en-sub">This study is conducted to determine the perceptual performance of a developed speech compression method. You are expected to listen carefully to the presented audio samples and rate the quality of the sound you hear according to the specified criteria.</span>
        </p>
        
        <h3>ğŸ§ Test YÃ¶nergesi <span class="en-sub">(Test Instructions)</span></h3>
        <ul>
            <li>LÃ¼tfen testi <strong>kulaklÄ±k</strong> ile ve sessiz bir ortamda gerÃ§ekleÅŸtiriniz.
                <span class="en-sub">(Please use <strong>headphones</strong> in a quiet environment.)</span>
            </li>
            <li><strong>Ã–nemli:</strong> Puanlama butonlarÄ±nÄ±n aktif olmasÄ± iÃ§in Ã¶nce sesi oynatmanÄ±z gerekmektedir.
                <span class="en-sub">(<strong>Important:</strong> You must play the audio first to enable the rating buttons.)</span>
            </li>
            <li>Her bir sesi dinleyip, genel konuÅŸma kalitesini aÅŸaÄŸÄ±daki rehbere gÃ¶re puanlayÄ±nÄ±z.
                <span class="en-sub">(Listen to each audio and rate the general speech quality according to the guide below.)</span>
            </li>
        </ul>
    </div>

    <table class="rating-guide-table">
        <thead>
            <tr>
                <th style="width: 10%;">Puan<br><span style="font-weight:normal; font-size:0.8em;">(Score)</span></th>
                <th style="width: 25%;">Kategori<br><span style="font-weight:normal; font-size:0.8em;">(Category)</span></th>
                <th>AÃ§Ä±klama ve KoÅŸullar<br><span style="font-weight:normal; font-size:0.8em;">(Description & Conditions)</span></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><span class="score-badge score-5">5</span></td>
                <td><strong>MÃ¼kemmel</strong><br><span class="en-sub">Excellent</span></td>
                <td>
                    Ã‡ok yÃ¼ksek konuÅŸma kalitesi; kusurlar yok veya fark edilmeyecek dÃ¼zeyde.
                    <span class="en-sub">Very high speech quality; imperfections are non-existent or imperceptible.</span>
                </td>
            </tr>
            <tr>
                <td><span class="score-badge score-4">4</span></td>
                <td><strong>Ä°yi</strong><br><span class="en-sub">Good</span></td>
                <td>
                    KÃ¼Ã§Ã¼k kusurlar duyulabilir ama genel kaliteyi belirgin etkilemez; konuÅŸma rahat takip edilir.
                    <span class="en-sub">Minor imperfections can be heard but do not significantly affect general quality; speech is easily followed.</span>
                </td>
            </tr>
            <tr>
                <td><span class="score-badge score-3">3</span></td>
                <td><strong>Orta</strong><br><span class="en-sub">Fair</span></td>
                <td>
                    Kusurlar belirgin; kalite orta dÃ¼zeyde, yine de konuÅŸma anlaÅŸÄ±lÄ±r.
                    <span class="en-sub">Imperfections are distinct; quality is moderate, yet speech is intelligible.</span>
                </td>
            </tr>
            <tr>
                <td><span class="score-badge score-2">2</span></td>
                <td><strong>KÃ¶tÃ¼</strong><br><span class="en-sub">Poor</span></td>
                <td>
                    Kalite belirgin dÃ¼ÅŸÃ¼k; artefakt/gÃ¼rÃ¼ltÃ¼ nedeniyle dinlemek Ã§aba gerektirir.
                    <span class="en-sub">Quality is clearly low; listening requires effort due to artifacts/noise.</span>
                </td>
            </tr>
            <tr>
                <td><span class="score-badge score-1">1</span></td>
                <td><strong>Ã‡ok KÃ¶tÃ¼</strong><br><span class="en-sub">Bad</span></td>
                <td>
                    Kabul edilemez kalite; konuÅŸma sÄ±k sÄ±k anlaÅŸÄ±lamaz veya ciddi biÃ§imde rahatsÄ±z edicidir.
                    <span class="en-sub">Unacceptable quality; speech is frequently unintelligible or severely annoying.</span>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="calibration-box">
        <h3>ğŸ”Š Ses Seviyesi AyarÄ± (Kalibrasyon) <span class="en-sub">(Volume Adjustment - Calibration)</span></h3>
        <p>
            LÃ¼tfen aÅŸaÄŸÄ±daki Ã¶rnek sesi dinleyerek kulaklÄ±k/hoparlÃ¶r ses seviyesini <strong>rahat ve net duyabileceÄŸiniz</strong> bir dÃ¼zeye ayarlayÄ±nÄ±z. Test boyunca bu seviyeyi deÄŸiÅŸtirmemeniz Ã¶nerilir.
            <span class="en-sub">Please listen to the sample audio below and adjust your headphone/speaker volume to a <strong>comfortable and clear level</strong>. It is recommended not to change this level during the test.</span>
        </p>
        <div style="text-align: center;">
            <audio controls src="audio/sample_01_original_1.wav" style="max-width: 400px;"></audio>
        </div>
    </div>
    <form id="mos-form">
        <input type="hidden" name="Sure_Saniye" id="durationInput">

        <div class="sample-card">
            <div class="sample-header">
                <span class="sample-title">KatÄ±lÄ±mcÄ± Bilgisi (Zorunlu) <span class="en-sub">(Participant Info - Required)</span></span>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>AdÄ±nÄ±z / Rumuzunuz: <span class="en-sub">(Name / Nickname)</span></label>
                    <input type="text" name="Katilimci_Ismi" placeholder="Ã–rn: Yavuz B." required>
                </div>
                <div class="form-group">
                    <label>Dinleme EkipmanÄ±: <span class="en-sub">(Listening Equipment)</span></label>
                    <select name="Kulaklik_Tipi">
                        <option value="Kablolu_Kulaklik">Kablolu KulaklÄ±k (Wired Headphones)</option>
                        <option value="Bluetooth_Kulaklik">Bluetooth KulaklÄ±k (Bluetooth Headphones)</option>
                        <option value="Hoparlor">HoparlÃ¶r (Speaker)</option>
                        <option value="Diger">DiÄŸer (Other)</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="audio-container" class="loading">
            Ses dosyalarÄ± hazÄ±rlanÄ±yor... <br> 
            <span class="en-sub">(Preparing audio files...)</span>
        </div>

        <button type="submit" id="submit-btn">
            Testi Tamamla ve GÃ¶nder <br> 
            <span class="en-sub" style="color:white; font-size:0.8em;">(Complete Test and Submit)</span>
        </button>
    </form>

    <div class="footer">
        Â© 2026 Akademik AraÅŸtÄ±rma Grubu - Academic Research Group<br>
        Bu Ã§alÄ±ÅŸma bilimsel veri toplama amaÃ§lÄ±dÄ±r.
    </div>

    <script>
        // --- 1. AYARLAR ---
        const scriptURL = 'https://script.google.com/macros/s/AKfycbys0EXNGfyYc7OT3w8-DBDazw9CyPiQjRFCv2i-u-jHppF0aANUx5TQaYxkQ5KMUDwv/exec';

        // --- 2. DOSYA TANIMLAMALARI ---
        const indexler = ["01", "02", "04", "06", "07", "09", "11", "12", "13", "15", "17", "18", "22", "23", "26", "32", "36", "42", "46"];
        const varyasyonlar = ["original_1", "recon_0_8", "recon_1_6", "recon_3_2", "recon_4"];

        // BaÅŸlangÄ±Ã§ ZamanÄ±
        const startTime = Date.now();

        // --- 3. LÄ°STE OLUÅTURMA VE KARIÅTIRMA ---
        let oynatmaListesi = [];

        indexler.forEach(idx => {
            varyasyonlar.forEach(tur => {
                oynatmaListesi.push({
                    dosyaYolu: `audio/sample_${idx}_${tur}.wav`,
                    sutunAdi: `sample_${idx}_${tur}`,
                    benzersizID: `box_${idx}_${tur}`
                });
            });
        });

        // Fisher-Yates Shuffle
        function karistir(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        oynatmaListesi = karistir(oynatmaListesi);

        // --- 4. EKRANA BASMA ---
        const container = document.getElementById('audio-container');
        container.innerHTML = ""; 
        container.classList.remove("loading");

        oynatmaListesi.forEach((item, index) => {
            const htmlContent = `
            <div class="sample-card">
                <div class="sample-header">
                    <span class="sample-title">
                        Ses KaydÄ± #${index + 1} 
                        <span class="en-sub" style="display:inline; margin-left:5px;">(Audio Sample #${index + 1})</span>
                    </span>
                    <span style="font-weight:normal; font-size:0.8em; color:#999;">${index + 1} / ${oynatmaListesi.length}</span>
                </div>
                
                <audio controls controlsList="nodownload" preload="none" 
                       src="${item.dosyaYolu}" 
                       onplay="unlockRating('${item.benzersizID}')">
                </audio>

                <div id="${item.benzersizID}" class="rating-container locked">
                    <span class="rating-title">Kalite PuanÄ±nÄ±z: <span class="en-sub" style="display:inline;">(Your Quality Score:)</span></span>
                    
                    <div class="rating-group">
                        <label class="rating-label">
                            <input type="radio" name="${item.sutunAdi}" value="1" required disabled onchange="updateProgress()">
                            <span class="rating-val">1</span>
                            <span class="rating-desc">Ã‡ok KÃ¶tÃ¼<br><i>(Bad)</i></span>
                        </label>
                        <label class="rating-label">
                            <input type="radio" name="${item.sutunAdi}" value="2" disabled onchange="updateProgress()">
                            <span class="rating-val">2</span>
                            <span class="rating-desc">KÃ¶tÃ¼<br><i>(Poor)</i></span>
                        </label>
                        <label class="rating-label">
                            <input type="radio" name="${item.sutunAdi}" value="3" disabled onchange="updateProgress()">
                            <span class="rating-val">3</span>
                            <span class="rating-desc">Orta<br><i>(Fair)</i></span>
                        </label>
                        <label class="rating-label">
                            <input type="radio" name="${item.sutunAdi}" value="4" disabled onchange="updateProgress()">
                            <span class="rating-val">4</span>
                            <span class="rating-desc">Ä°yi<br><i>(Good)</i></span>
                        </label>
                        <label class="rating-label">
                            <input type="radio" name="${item.sutunAdi}" value="5" disabled onchange="updateProgress()">
                            <span class="rating-val">5</span>
                            <span class="rating-desc">MÃ¼kemmel<br><i>(Excellent)</i></span>
                        </label>
                    </div>
                </div>
            </div>`;
            container.innerHTML += htmlContent;
        });

        // --- 5. FONKSÄ°YONLAR ---

        window.unlockRating = function(elementId) {
            const container = document.getElementById(elementId);
            if (container.classList.contains('locked')) {
                container.classList.remove('locked');
                const inputs = container.querySelectorAll('input');
                inputs.forEach(input => input.disabled = false);
            }
        };

        window.updateProgress = function() {
            const total = oynatmaListesi.length;
            const answered = document.querySelectorAll('input[type="radio"]:checked').length;
            const percentage = Math.round((answered / total) * 100);
            document.getElementById('progressBar').style.width = percentage + "%";
            document.getElementById('progressText').innerText = percentage + "%";
        };

        // --- 6. GÃ–NDERME Ä°ÅLEMÄ° ---
        const form = document.getElementById('mos-form');
        const submitBtn = document.getElementById('submit-btn');

        form.addEventListener('submit', e => {
            e.preventDefault();
            
            const endTime = Date.now();
            const durationSeconds = Math.round((endTime - startTime) / 1000);
            document.getElementById('durationInput').value = durationSeconds;

            submitBtn.innerHTML = "SonuÃ§lar Sunucuya GÃ¶nderiliyor... <br> <span class='en-sub' style='color:white;'>(Sending results to server...)</span>";
            submitBtn.style.backgroundColor = "#f39c12"; 
            submitBtn.disabled = true;

            const formData = new FormData(form);

            fetch(scriptURL, { method: 'POST', body: formData})
                .then(response => {
                    alert("âœ… Ä°ÅŸlem TamamlandÄ±!\nTÃ¼m puanlarÄ±nÄ±z baÅŸarÄ±yla kaydedildi.\n\n(Process Completed! Scores saved successfully.)");
                    submitBtn.innerHTML = "GÃ¶nderildi âœ… <br> <span class='en-sub' style='color:white;'>(Submitted)</span>";
                    submitBtn.style.backgroundColor = "#27ae60"; 
                })
                .catch(error => {
                    console.error('Hata', error);
                    alert("âŒ Hata oluÅŸtu! / Error occurred!");
                    submitBtn.innerHTML = "Tekrar Dene / Try Again";
                    submitBtn.style.backgroundColor = "#c0392b"; 
                    submitBtn.disabled = false;
                });
        });
    </script>
</body>
</html>
